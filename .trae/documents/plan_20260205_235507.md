# 修复语音输入：支持实时显示与自动语言检测

用户反馈语音输入后无法上屏。原因主要有两点：

1.  **语言设置**: 代码中硬编码了 `en-US`，而用户输入的是中文，导致识别引擎可能忽略输入或无法正确识别。
2.  **实时反馈**: 之前的实现只处理 `isFinal` (最终结果)，导致在说话过程中没有文字显示，用户体验不佳。

我们将改进实现，支持实时流式显示（Interim Results）并自动适配浏览器语言。

## 计划步骤

### 1. 修改 `ui/src/ui/app.ts`

- **新增状态**: 添加 `private recordingSessionBase = "";` 用于记录开始录音时的已有文本。
- **优化 `toggleRecording`**:
  - **语言适配**: 将 `recognition.lang` 设置为 `navigator.language || "zh-CN"`，优先使用浏览器语言。
  - **实时显示逻辑**:
    - `onstart`: 记录 `this.recordingSessionBase = this.chatMessage`。
    - `onresult`: 遍历 `event.results`，拼接所有识别结果（包含未完成的 Interim 结果），然后更新 `this.chatMessage = this.recordingSessionBase + 新识别的内容`。
  - **错误处理**: 增加 `onerror` 的日志输出，确保出错时重置状态。

这将确保：

1.  支持中文识别。
2.  用户说话时字会即时跳出来，而不是等说完才显示。

**是否确认执行？**
