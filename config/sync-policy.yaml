# Sync Policy Configuration - RC10
# Defines how we sync with upstream and other forks

version: "1.0.0"
lastUpdated: "2026-02-05"

# Upstream Sync Configuration
upstream:
  repo: openclaw/openclaw
  branch: main

  # Sync schedule
  schedule:
    frequency: weekly
    cron: "0 6 * * 1" # Mondays 6:00 UTC
    timezone: "America/Sao_Paulo"

  # Auto-sync behavior
  automation:
    enabled: true
    requireReview: true
    autoMerge: false

    # What to auto-sync
    autoSyncPaths:
      - "src/**"
      - "lib/**"
      - "package.json"
      - "package-lock.json"

    # What to never auto-sync (our customizations)
    excludePaths:
      - ".github/workflows/**"
      - "config/**"
      - "agents/**"
      - "schemas/**"
      - "CHANGELOG.md"
      - "README.md" # We may have custom readme

  # Conflict resolution
  conflicts:
    strategy: "ours-for-config" # Keep our configs, take theirs for code

    # Paths where we always keep ours
    preferOurs:
      - "config/**"
      - "agents/**"
      - ".github/**"

    # Paths where we always take theirs
    preferTheirs:
      - "src/core/**"
      - "lib/**"

    # Paths that require human resolution
    requireHuman:
      - "package.json" # Dependency changes need review
      - "security/**"

  # Notifications
  notifications:
    onSyncStart: false
    onSyncComplete: true
    onConflict: true
    channel: github-issue

# Harvest Configuration (from other forks)
harvest:
  enabled: true

  # Forks to monitor
  sources:
    # Upstream is primary source
    - repo: openclaw/openclaw
      priority: high
      autoReview: true

    # Future: add interesting forks here
    # - repo: some-user/openclaw
    #   priority: medium
    #   focus: ["specific-feature"]

  # Schedule (Fork Forest Monitor)
  schedule:
    frequency: weekly
    cron: "0 6 * * 1" # Same as upstream sync

  # Analysis configuration
  analysis:
    # Commit age filter
    minCommitAge: 7d
    maxCommitAge: 90d

    # What to look for
    patterns:
      include:
        - "^feat:" # New features
        - "^fix:" # Bug fixes
        - "^perf:" # Performance improvements
        - "^security:" # Security fixes
      exclude:
        - "^chore:" # Skip maintenance commits
        - "^docs:" # Skip doc-only changes
        - "^ci:" # Skip CI changes
        - "\\[skip harvest\\]" # Explicit skip marker

    # Auto-classification thresholds
    classification:
      autoHarvest:
        maxFiles: 5
        maxLines: 200
        requireTests: false

      requireReview:
        maxFiles: 20
        maxLines: 1000

      # Anything larger needs human decision
      requireHuman:
        files: "> 20"
        lines: "> 1000"

  # Review process
  review:
    autoCreatePR: true
    labelPrefix: "harvest:"
    assignReviewers:
      - eko-bot
    requiredApprovals: 1

    # Template for harvest PRs
    prTemplate: |
      ## ðŸŒ¾ Harvest from {source}

      **Commits:** {commitCount}
      **Source:** {sourceRepo}
      **Range:** {commitRange}

      ### Changes
      {changesSummary}

      ### Classification
      - [ ] Safe to auto-merge
      - [ ] Needs human review
      - [ ] Conflicts detected

      ---
      *Auto-generated by harvest workflow*

# Seed Tracking (our forks)
seed:
  enabled: true

  # Our repo being tracked
  repo: ekson73/openclaw

  # What to track
  metrics:
    forkCount: true
    starCount: true
    adoptionCommits: true # When forks cherry-pick our commits

  # Report configuration
  report:
    frequency: weekly
    format: github-issue
    label: "fork-forest"

# Branch Sync Rules
branches:
  # upstream-sync: pure mirror
  upstream-sync:
    source: upstream/main
    strategy: reset # Force reset to upstream
    frequency: daily

  # main: careful sync
  main:
    source: upstream-sync
    strategy: merge
    frequency: weekly
    requireReview: true

  # develop: manual sync only
  develop:
    source: main
    strategy: rebase
    frequency: manual

  # stable: release-based only
  stable:
    source: main
    strategy: cherry-pick
    frequency: release-only

# SLA for sync operations
sla:
  upstreamSync:
    maxDelayDays: 7
    escalateAfterDays: 14

  harvestReview:
    maxDelayHours: 48
    escalateAfterHours: 72

  conflictResolution:
    maxDelayHours: 24
    escalateAfterHours: 48
